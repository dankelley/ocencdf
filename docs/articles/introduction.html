<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to ocencdf • ocencdf</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to ocencdf">
<meta property="og:description" content="ocencdf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ocencdf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/built_in_vartables.html">Built-in varTables</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to ocencdf</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dankelley/ocencdf/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to ocencdf</h1>
                        <h4 data-toc-skip class="author">Dan Kelley (<a href="https://orcid.org/0000-0001-7808-5911" class="external-link uri">https://orcid.org/0000-0001-7808-5911</a>)</h4>
            
            <h4 data-toc-skip class="date">2024-01-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dankelley/ocencdf/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<!--
Building this vignette.

1. Edit vignettes/oce.Rmd in a plain-text editor.

2. In a unix shell at the level above ocencdf, type the following:

       R CMD build --compact-vignettes="qpdf" ocencdf
       R CMD install ocencdf_0.0-1.tar.gz

   where the version number may need adjustment in the second command.

3. To see the results, type the following in an R console:

      browseVignettes("ocencdf")
-->
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>The <code>ocencdf</code> package provides a way to store approximate
forms of oce objects as NetCDF files, and to translate those files back
into oce objects. This is useful because NetCDF format is handled in a
wide variety of computing languages, and is commonly used in data
archives.</p>
<p>The package provides both “forward” and “reverse” functions. The
former translate oce objects to NetCDF, and the latter transfer NetCDF
files (made by the package) back into oce objects.</p>
<p>It should be noted that the reverse functions are designed to work
with NetCDF files created by the forward functions, with
e.g. <code><a href="../reference/ncdf2ctd.html">ncdf2ctd()</a></code> handling NetCDF files created by
<code><a href="../reference/ctd2ncdf.html">ctd2ncdf()</a></code> based on oce objects. The reverse functions may
be able to handle the data portions of other NetCDF files, but they do
not parse the attribute portions of those NetCDF files in a useful way.
This is because there is no way for the code to know what conventions
were used in creating an arbitrary NetCDF file. For example, a CTD
dataset might record the ship name, the name of the research program,
etc., but whether these things are recorded in the data section of the
NetCDF file, or in attributes, or not at all, cannot be known before the
fact, and guessing is a risky proposition.</p>
</div>
<div class="section level2">
<h2 id="limitations-of-netcdf-format">Limitations of NetCDF format<a class="anchor" aria-label="anchor" href="#limitations-of-netcdf-format"></a>
</h2>
<p>Unfortunately, direct transferal of R information to NetCDF is not
possible. This is because NetCDF is an array-oriented format that is not
designed to hold tree-oriented data such as R lists (which are used
throughout oce). It is possible to flatten simple lists, but the process
gets complicated for nested lists, which are common in oce. Other
difficulties with the NetCDF format include its lack of basic elements
programming elements such as user-defined classes and variable-length
character strings in the data portion of the files.</p>
<p>This package is in early development, and efforts are focused on a
single oce class, the ctd object. This focus is intended to permit
coding practices to gel, in preparation for the addition of other
classes. Given the anticipated needs of users, the next planned item for
support is ADCP data.</p>
</div>
<div class="section level2">
<h2 id="how-the-package-works">How the package works<a class="anchor" aria-label="anchor" href="#how-the-package-works"></a>
</h2>
<div class="section level3">
<h3 id="focus-elements">Focus elements<a class="anchor" aria-label="anchor" href="#focus-elements"></a>
</h3>
<p>The design goal is to save the following elements</p>
<ol style="list-style-type: decimal">
<li>Entries in the <code>data</code> slot (e.g. temperature, salinity,
etc.), renamed as appropriate.</li>
<li>The <code>metadata</code> slot (saved in a string form as a global
attribute).</li>
<li>An approximate form of units, as strings (to fit NetCDF
conventions).</li>
<li>Information on the conversion process.</li>
</ol>
</div>
<div class="section level3">
<h3 id="renaming-elements">Renaming elements<a class="anchor" aria-label="anchor" href="#renaming-elements"></a>
</h3>
<p>Oce uses a restricted set of names for certain variables. For
example, in ctd objects, temperature is called <code>temperature</code>,
and if the ctd had two temperature sensors, there would be an additional
entry called <code>temperature2</code>. These are not typically the
names used in raw data files, however. More commonly, temperature might
be named <code>TEMP</code>, for example. In recognition of this, ocencdf
provides a way to rename oce objects using other systems of names. The
mapping between oce name and other name is controlled by YAML (yet
another markup language) files, which are called varTables in this
package. Tables are provided for the Argo system and for the World
Hydrographic Program system. These are available as <code>"argo"</code>
and <code>"whp"</code>, respectively. They are stored in the
<code>inst/extdata</code> directory of the package source tree. Users
seeking to define new naming systems must copy the formats of those
files.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-with-ctd-data">Example with CTD data<a class="anchor" aria-label="anchor" href="#example-with-ctd-data"></a>
</h2>
<p>The first step is to create an oce object, e.g. station 100 of the
built-in <code>section</code> dataset. Note the variable names, units,
and flag values in the summary.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/ocencdf/" class="external-link">ocencdf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: oce</span></span>
<span><span class="co">#&gt; Loading required package: gsw</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dankelley.github.io/oce/" class="external-link">oce</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span></span>
<span><span class="va">stn</span> <span class="op">&lt;-</span> <span class="va">section</span><span class="op">[[</span><span class="st">"station"</span>, <span class="fl">100</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stn</span><span class="op">)</span></span>
<span><span class="co">#&gt; CTD Summary</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Start time:          1993-10-22 03:10:00</span></span>
<span><span class="co">#&gt; * Station:             109</span></span>
<span><span class="co">#&gt; * Mean Location:       36.323N 69.376W</span></span>
<span><span class="co">#&gt; * Water depth:         4499</span></span>
<span><span class="co">#&gt; * Data Overview</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                 Min.   Mean   Max. Dim. NAs OriginalName</span></span>
<span><span class="co">#&gt;     pressure [dbar]             11.4 2182.5 4398.3   24   0       CTDPRS</span></span>
<span><span class="co">#&gt;     temperature [°C, IPTS-68] 2.2233 7.3839 23.554   24   0       CTDTMP</span></span>
<span><span class="co">#&gt;     salinity [PSS-78]         34.883 35.315 36.692   24   0       CTDSAL</span></span>
<span><span class="co">#&gt;     salinityBottle [PSS-78]   34.889 35.315 36.702   24   0       SALNTY</span></span>
<span><span class="co">#&gt;     oxygen [μmol/kg]           144.9 246.91  282.1   24   0       OXYGEN</span></span>
<span><span class="co">#&gt;     silicate [μmol/kg]          1.71 16.852  36.52   24   0       SILCAT</span></span>
<span><span class="co">#&gt;     nitrite [μmol/kg]              0  0.022   0.08   24  19       NITRIT</span></span>
<span><span class="co">#&gt;     NO2+NO3 [μmol/kg]              0 14.619  23.73   24   0      NO2+NO3</span></span>
<span><span class="co">#&gt;     phosphate [μmol/kg]            0 0.8925   1.39   24   0       PHSPHT</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Data-quality Flag Scheme</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     name    "WHP bottle"</span></span>
<span><span class="co">#&gt;     mapping list(no_information=1, no_problems_noted=2, leaking=3, did_not_trip=4, not_reported=5, discrepency=6, unknown_problem=7, did_not_trip=8, no_sample=9)</span></span>
<span><span class="co">#&gt;     default c(1, 3, 4, 5, 6, 7, 8, 9)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Data-quality Flags</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     salinity:       "2" 22, "3" 2</span></span>
<span><span class="co">#&gt;     salinityBottle: "2" 24</span></span>
<span><span class="co">#&gt;     oxygen:         "2" 24</span></span>
<span><span class="co">#&gt;     silicate:       "2" 24</span></span>
<span><span class="co">#&gt;     nitrite:        "2" 5, "5" 19</span></span>
<span><span class="co">#&gt;     NO2+NO3:        "2" 24</span></span>
<span><span class="co">#&gt;     phosphate:      "2" 24</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Processing Log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     - 2022-01-03 13:21:08 UTC: `create 'ctd' object`</span></span>
<span><span class="co">#&gt;     - 2022-01-03 13:21:08 UTC: `initializeFlagScheme(object, name="WHP bottle", mapping=list(no_information=1,no_problems_noted=2,leaking=3,did_not_trip=4,not_reported=5,discrepency=6,unknown_problem=7,did_not_trip=8,no_sample=9)), default=c(1,3,4,5,6,7,8,9))`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stn</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Now, save as a NetCDF file, using (say) the Argo convention for
variable names.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ncfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"argo"</span>, fileext <span class="op">=</span> <span class="st">".nc"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/oce2ncdf.html">oce2ncdf</a></span><span class="op">(</span><span class="va">stn</span>, varTable <span class="op">=</span> <span class="st">"argo"</span>, ncfile <span class="op">=</span> <span class="va">ncfile</span><span class="op">)</span></span>
<span><span class="co">#&gt; Converting temperature from IPTS-68 scale to ITS-90 scale.</span></span></code></pre></div>
<p>The temporary NetCDF file may be examined in various ways, but we
leave that up to the reader. Note that the column names are
e.g. <code>TEMP</code> in the NetCDF file, because the varTable named
<code>"argo"</code> establishes that nickname.</p>
<p>We can read the temporary NetCDF file into a ctd object and get a
summary with the following.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">STN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ncdf2ctd.html">ncdf2ctd</a></span><span class="op">(</span><span class="va">ncfile</span>, varTable <span class="op">=</span> <span class="st">"argo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">STN</span><span class="op">)</span></span>
<span><span class="co">#&gt; CTD Summary</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Start time:          1993-10-22 03:10:00</span></span>
<span><span class="co">#&gt; * Station:             109</span></span>
<span><span class="co">#&gt; * Mean Location:       36.323N 69.376W</span></span>
<span><span class="co">#&gt; * Water depth:         4499</span></span>
<span><span class="co">#&gt; * Data Overview</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                 Min.   Mean   Max. Dim. NAs OriginalName</span></span>
<span><span class="co">#&gt;     pressure [dbar]             11.4 2182.5 4398.3   24   0       CTDPRS</span></span>
<span><span class="co">#&gt;     temperature [°C, IPTS-68] 2.2228 7.3822 23.548   24   0       CTDTMP</span></span>
<span><span class="co">#&gt;     salinity [PSS-78]         34.883 35.315 36.692   24   0       CTDSAL</span></span>
<span><span class="co">#&gt;     salinityBottle [PSS-78]   34.889 35.315 36.702   24   0       SALNTY</span></span>
<span><span class="co">#&gt;     oxygen [μmol/kg]           144.9 246.91  282.1   24   0       OXYGEN</span></span>
<span><span class="co">#&gt;     silicate [μmol/kg]          1.71 16.853  36.52   24   0       SILCAT</span></span>
<span><span class="co">#&gt;     nitrite [μmol/kg]              0  0.022   0.08   24  19       NITRIT</span></span>
<span><span class="co">#&gt;     NO2+NO3 [μmol/kg]              0 14.619  23.73   24   0      NO2+NO3</span></span>
<span><span class="co">#&gt;     phosphate [μmol/kg]            0 0.8925   1.39   24   0       PHSPHT</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Data-quality Flag Scheme</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     name    "WHP bottle"</span></span>
<span><span class="co">#&gt;     mapping list(no_information=1L, no_problems_noted=2L, leaking=3L, did_not_trip=4L, not_reported=5L, discrepency=6L, unknown_problem=7L, did_not_trip.1=8L, no_sample=9L)</span></span>
<span><span class="co">#&gt;     default c(1L, 3L, 4L, 5L, 6L, 7L, 8L, 9L)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Data-quality Flags</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     salinity:       "2" 22, "3" 2</span></span>
<span><span class="co">#&gt;     salinityBottle: "2" 24</span></span>
<span><span class="co">#&gt;     oxygen:         "2" 24</span></span>
<span><span class="co">#&gt;     silicate:       "2" 24</span></span>
<span><span class="co">#&gt;     nitrite:        "2" 5, "5" 19</span></span>
<span><span class="co">#&gt;     NO2+NO3:        "2" 24</span></span>
<span><span class="co">#&gt;     phosphate:      "2" 24</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Processing Log</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     - 2024-01-26 13:39:27 UTC: `create 'ctd' object`</span></span>
<span><span class="co">#&gt;     - 2024-01-26 13:39:27 UTC: `as.ctd(salinity = ncdf2oce(ncfile = ncfile, varTable = varTable,     debug = debug))`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">STN</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Dan Kelley.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
